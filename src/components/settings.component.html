<div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700 max-w-4xl mx-auto">
  <!-- Header & Tabs -->
  <div class="px-6 pt-6">
    <div class="flex items-center gap-2 mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-teal-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
      <h2 class="text-2xl font-bold text-white">{{ languageService.translate('settings.title') }}</h2>
    </div>
    <div class="flex border-b border-gray-700 overflow-x-auto">
      <button (click)="setTab('general')" class="px-4 py-2 text-sm font-medium border-b-2 whitespace-nowrap" [class.border-teal-500]="currentTab() === 'general'" [class.text-white]="currentTab() === 'general'" [class.border-transparent]="currentTab() !== 'general'" [class.text-gray-400]="currentTab() !== 'general'">{{ languageService.translate('settings.tabs.general') }}</button>
      <button (click)="setTab('system')" class="px-4 py-2 text-sm font-medium border-b-2 whitespace-nowrap" [class.border-teal-500]="currentTab() === 'system'" [class.text-white]="currentTab() === 'system'" [class.border-transparent]="currentTab() !== 'system'" [class.text-gray-400]="currentTab() !== 'system'">System</button>
      <button (click)="setTab('network')" class="px-4 py-2 text-sm font-medium border-b-2 whitespace-nowrap" [class.border-teal-500]="currentTab() === 'network'" [class.text-white]="currentTab() === 'network'" [class.border-transparent]="currentTab() !== 'network'" [class.text-gray-400]="currentTab() !== 'network'">{{ languageService.translate('settings.tabs.network') }}</button>
      <button (click)="setTab('installer')" class="px-4 py-2 text-sm font-medium border-b-2 whitespace-nowrap" [class.border-teal-500]="currentTab() === 'installer'" [class.text-white]="currentTab() === 'installer'" [class.border-transparent]="currentTab() !== 'installer'" [class.text-gray-400]="currentTab() !== 'installer'">{{ languageService.translate('settings.tabs.installer') }}</button>
      <button (click)="setTab('ssh')" class="px-4 py-2 text-sm font-medium border-b-2 whitespace-nowrap" [class.border-indigo-500]="currentTab() === 'ssh'" [class.text-indigo-400]="currentTab() === 'ssh'" [class.border-transparent]="currentTab() !== 'ssh'" [class.text-gray-400]="currentTab() !== 'ssh'">SSH</button>
      <button (click)="setTab('security')" class="px-4 py-2 text-sm font-medium border-b-2 whitespace-nowrap" [class.border-teal-500]="currentTab() === 'security'" [class.text-white]="currentTab() === 'security'" [class.border-transparent]="currentTab() !== 'security'" [class.text-gray-400]="currentTab() !== 'security'">{{ languageService.translate('settings.tabs.security') }}</button>
      <button (click)="setTab('advanced')" class="px-4 py-2 text-sm font-medium border-b-2 whitespace-nowrap" [class.border-teal-500]="currentTab() === 'advanced'" [class.text-white]="currentTab() === 'advanced'" [class.border-transparent]="currentTab() !== 'advanced'" [class.text-gray-400]="currentTab() !== 'advanced'">{{ languageService.translate('settings.tabs.advanced') }}</button>
    </div>
  </div>

  <!-- Tab Content -->
  <div class="p-6">
    @switch (currentTab()) {
      @case ('general') {
        <div class="space-y-8">
          <div class="bg-gray-900/50 p-6 rounded-lg border border-gray-700">
            <h3 class="text-lg font-bold text-gray-200 mb-1">{{ languageService.translate('settings.credentials.title') }}</h3>
            <form [formGroup]="adminForm" (ngSubmit)="saveCredentials()" class="max-w-md mt-4">
              <div class="space-y-4">
                <div>
                  <label class="block text-gray-400 text-sm mb-1 uppercase font-bold">{{ languageService.translate('settings.credentials.newUser') }}</label>
                  <input formControlName="username" type="text" class="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white focus:border-teal-500 outline-none">
                </div>
                <div>
                  <label class="block text-gray-400 text-sm mb-1 uppercase font-bold">{{ languageService.translate('settings.credentials.newPass') }}</label>
                  <input formControlName="password" type="password" class="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white focus:border-teal-500 outline-none">
                </div>
              </div>
              <div class="mt-8 flex justify-end items-center gap-4">
                @if (successMessage()) { <span class="text-green-400 text-sm animate-pulse font-bold">{{ successMessage() }}</span> }
                <button type="submit" [disabled]="adminForm.invalid" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-6 rounded transition-colors">{{ languageService.translate('common.saveChanges') }}</button>
              </div>
            </form>
          </div>
        </div>
      }
      @case ('system') {
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <!-- Database Management -->
              <div class="bg-gray-900/50 p-6 rounded-lg border border-gray-700">
                  <h3 class="text-lg font-bold text-white mb-4">Database Management (Local)</h3>
                  <div class="space-y-4">
                      <button (click)="exportSettings()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        Export Settings
                      </button>
                      
                      <div class="relative">
                          <input type="file" id="fileInput" (change)="onFileSelected($event)" class="hidden">
                          <button (click)="triggerImport()" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1H3zm5-9V3a1 1 0 112 0v5h2a1 1 0 011 1v4a1 1 0 01-1 1H6a1 1 0 01-1-1V9a1 1 0 011-1h2z" clip-rule="evenodd" /></svg>
                            Import Backup
                          </button>
                      </div>
                      @if(importError()) { <p class="text-red-400 text-center text-sm">{{ importError() }}</p> }
                  </div>
              </div>

              <!-- SMTP Settings -->
              <div class="bg-gray-900/50 p-6 rounded-lg border border-gray-700">
                  <h3 class="text-lg font-bold text-white mb-4">Email Notification (SMTP)</h3>
                  <form [formGroup]="smtpForm" (ngSubmit)="saveSmtp()" class="space-y-3">
                      <div><input formControlName="host" placeholder="SMTP Host" class="w-full bg-gray-800 rounded p-2 text-white border border-gray-600 text-sm"></div>
                      <div class="flex gap-2">
                         <input formControlName="port" placeholder="Port" type="number" class="w-1/3 bg-gray-800 rounded p-2 text-white border border-gray-600 text-sm">
                         <input formControlName="user" placeholder="User" class="flex-1 bg-gray-800 rounded p-2 text-white border border-gray-600 text-sm">
                      </div>
                      <div><input formControlName="pass" placeholder="Password" type="password" class="w-full bg-gray-800 rounded p-2 text-white border border-gray-600 text-sm"></div>
                      <div><input formControlName="senderEmail" placeholder="Sender Email" class="w-full bg-gray-800 rounded p-2 text-white border border-gray-600 text-sm"></div>
                      
                      <div class="flex justify-between items-center pt-2">
                          <button type="button" (click)="testEmail()" class="text-sm text-blue-400 hover:text-blue-300">
                              @if(emailTestStatus() === 'sending') { Sending... }
                              @else if(emailTestStatus() === 'success') { Sent! }
                              @else { Test Email }
                          </button>
                          <button type="submit" class="bg-teal-600 px-4 py-1.5 rounded text-white text-sm font-bold">Save</button>
                      </div>
                  </form>
              </div>
          </div>
      }
      @case('installer') {
        <app-remote-installer></app-remote-installer>
      }
      @case ('network') {
        <div class="space-y-8">
            <div class="border-b border-gray-700 pb-2">
                <h2 class="text-xl font-bold text-teal-400">Edge Server Configuration (Iran)</h2>
                <p class="text-sm text-gray-500">Settings specific to the domestic bridge server.</p>
            </div>
            <app-nat-traversal></app-nat-traversal>
            <div class="border-b border-gray-700 pb-2 pt-4">
                <h2 class="text-xl font-bold text-blue-400">Upstream Configuration (Foreign)</h2>
                <p class="text-sm text-gray-500">Global connectivity settings.</p>
            </div>
            <app-domain-ssl></app-domain-ssl>
            <app-doh-settings></app-doh-settings>
            <app-endpoint-settings></app-endpoint-settings>
        </div>
      }
      @case('ssh') {
        <app-ssh-settings></app-ssh-settings>
      }
      @case ('security') {
        <div class="space-y-8">
          <app-camouflage-settings></app-camouflage-settings>
          <app-application-camouflage></app-application-camouflage>
        </div>
      }
      @case ('advanced') {
        <div class="space-y-8">
           <app-tunnel-optimization></app-tunnel-optimization>
           <app-iap-settings></app-iap-settings>
        </div>
      }
    }
  </div>
</div>